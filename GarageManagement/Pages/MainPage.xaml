<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:service="clr-namespace:GarageManagement.Services"
             x:Class="GarageManagement.Pages.MainPage"
             x:Name="RootContentView"
             BackgroundColor="{DynamicResource BackgroundColor}">

    <ContentPage.Resources>
        <Style x:Key="NavButtonStyle" TargetType="Frame">
            <Setter Property="CornerRadius" Value="0" />
            <Setter Property="Padding"      Value="8" />
            <Setter Property="Margin"       Value="4" />
            <Setter Property="HeightRequest" Value="40"/>
            <Setter Property="HasShadow"    Value="False"/>
            <Setter Property="BackgroundColor" 
          Value="{StaticResource InactiveBackgroundColor}"/>
        </Style>
        <ResourceDictionary>
            <service:BoolToColorConverterService x:Key="BoolToColorConverter" />
            <service:BoolToGridLengthConverter x:Key="BoolToGridLengthConverter" />
            <service:WidthToVisibilityConverter x:Key="WidthToVisibilityConverter" />
            <service:BoolToArrowConverter x:Key="BoolToArrowConverter" />
            <OnPlatform x:Key="CornerRadiusHandler" x:TypeArguments="x:Double">
                <On Platform="Android" Value="10" />
                <On Platform="iOS" Value="10" />
                <On Platform="Windows" Value="10" />
            </OnPlatform>
            <!-- ƒê·ªãnh nghƒ©a m√†u cho tr·∫°ng th√°i active -->
            <Color x:Key="ActiveBackgroundColor">#3b82f6</Color>
            <Color x:Key="InactiveBackgroundColor">#264f76</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="{Binding IsCollapsed, Converter={StaticResource BoolToGridLengthConverter}}" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="1" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <ScrollView>
            <VerticalStackLayout 
                BackgroundColor="#264f76"
                x:Name="CollapsibleToolbar"
                Spacing="10"
                Padding="10"
                Grid.Column="0"
                WidthRequest="200"
                MinimumWidthRequest="80">

                <HorizontalStackLayout>
                    <Button Text="‚ò∞"
                            x:Name="CollapseButton"
                            TextColor="White"
                            BackgroundColor="Transparent"
                            HorizontalOptions="End"
                            VerticalOptions="Center"
                            Clicked="OnCollapseClicked" />

                    <Label Text="Menu"
                           TextColor="White"
                           FontAttributes="Bold"
                           FontFamily="OpenSans-SemiBold"
                           FontSize="20"
                           HorizontalOptions="Center"
                           Margin="0,20,0,20" 
                           IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                </HorizontalStackLayout>

                <!-- Section: Qu·∫£n l√Ω -->
                <Frame BackgroundColor="#2a557f" IsVisible="{Binding QuanLiSection}"
                       CornerRadius="{StaticResource CornerRadiusHandler}"
                       Padding="10"
                       Margin="5"
                       HasShadow="True">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ToggleSectionCommand}" CommandParameter="QuanLy" />
                    </Frame.GestureRecognizers>
                    <HorizontalStackLayout>
                        <Label VerticalOptions="Center">üóÇÔ∏è</Label>
                        <Label Text="Qu·∫£n l√Ω"
                               TextColor="White"
                               FontAttributes="Bold"
                               FontFamily="OpenSans-SemiBold"
                               FontSize="16"
                               HorizontalOptions="Center"
                               Margin="5"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        <Label Text="{Binding QuanLyExpanded, Converter={StaticResource BoolToArrowConverter}}"
                               VerticalOptions="Center"
                               TextColor="White" />
                    </HorizontalStackLayout>
                </Frame>
                <VerticalStackLayout Spacing="5" 
                                     IsVisible="{Binding QuanLyExpanded}">
                    <Frame BackgroundColor="{Binding QlXeActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                           Style="{StaticResource NavButtonStyle}"
                           Margin="5"
                           HasShadow="True" IsVisible="{Binding QuanLiDanhSachXePermission}" >
                        <HorizontalStackLayout>
                            <Label Text="üöô"/>
                            <Label Text=" Danh s√°ch xe"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   LineBreakMode="WordWrap"
                                   MaximumWidthRequest="120"
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QLXe" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QlDanhSachHieuXeActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                           Style="{StaticResource NavButtonStyle}"
                           Margin="5"
                           HasShadow="True" IsVisible="{Binding QuanLiDanhSachHieuXePermission}">
                        <HorizontalStackLayout>

                            <Label Text="üè≠"/>
                            <Label Text=" Danh s√°ch hi·ªáu xe"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Start"
                                   
                                   MaximumWidthRequest="120"
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>

                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QLDanhSachHieuXe" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiDanhSachLoaiVatTuActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                           Margin="5"
                           Style="{StaticResource NavButtonStyle}"
                           HasShadow="True" IsVisible="{Binding QuanLiDanhSachLoaiVatTuPermission}">
                        <HorizontalStackLayout>
                            <Label Text="üì¶"/>
                            <Label Text=" Danh s√°ch v·∫≠t t∆∞"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   LineBreakMode="WordWrap"
                                   MaximumWidthRequest="120"
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QLDanhSachLoaiVatTu" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiDanhSachLoaiTienCongActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                           Margin="5"
                            Style="{StaticResource NavButtonStyle}"
                           HasShadow="True" IsVisible="{Binding QuanLiDanhSachLoaiTienCongPermission}">
                        <HorizontalStackLayout>
                            <Label Text="üíµ"/>
                            <Label Text=" DS lo·∫°i ti·ªÅn c√¥ng"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                 
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QLDanhSachLoaiTienCong" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiNhanVienActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                            CornerRadius="{StaticResource CornerRadiusHandler}"
                            Padding="10"
                            Margin="5"
                            Style="{StaticResource NavButtonStyle}"
                            HasShadow="True" IsVisible="{Binding QuanLiNhanVienPermission}">
                        <HorizontalStackLayout>
                            <Label>üë•</Label>
                            <Label Text="Danh s√°ch nh√¢n vi√™n"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   LineBreakMode="WordWrap"
                                 
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiNhanVien" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiKhachHangActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                            CornerRadius="{StaticResource CornerRadiusHandler}"
                            Padding="10"
                            Style="{StaticResource NavButtonStyle}"
                            Margin="5"
                            HasShadow="True" IsVisible="{Binding QuanLiKhachHangPermission}">
                        <HorizontalStackLayout>
                            <Label>ü§ù</Label>
                            <Label Text="Danh s√°ch kh√°ch h√†ng"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   LineBreakMode="WordWrap"
                             
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiKhachHang" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiPhieuNhapActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                            CornerRadius="{StaticResource CornerRadiusHandler}"
                            Padding="10"
                            Margin="5"
                            Style="{StaticResource NavButtonStyle}"
                            HasShadow="True" IsVisible="{Binding QuanLiPhieuNhapPermission}">
                        <HorizontalStackLayout>
                            <Label>üì•</Label>
                            <Label Text="Danh s√°ch phi·∫øu nh·∫≠p"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   LineBreakMode="WordWrap"
                                  
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiPhieuNhap" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiPhieuSuaChuaActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                            CornerRadius="{StaticResource CornerRadiusHandler}"
                            Padding="10"
                            Margin="5"
                            Style="{StaticResource NavButtonStyle}"
                            HasShadow="True" IsVisible="{Binding QuanLiPhieuSuaChuaPermission}">
                        <HorizontalStackLayout>
                            <Label>üîß</Label>
                            <Label Text="DS phi·∫øu s·ª≠a ch·ªØa"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                  
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiPhieuSuaChua" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiPhieuThuTienActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                            CornerRadius="{StaticResource CornerRadiusHandler}"
                            Padding="10"
                            Style="{StaticResource NavButtonStyle}"
                            Margin="5"
                            HasShadow="True" IsVisible="{Binding QuanLiPhieuThuTienPermission}">
                        <HorizontalStackLayout>
                            <Label>üßæ</Label>
                            <Label Text="DS phi·∫øu thu ti·ªÅn"
                                    TextColor="White"
                                    FontSize="14"
                                    FontFamily="OpenSans-Regular"
                                    HorizontalOptions="Center"
                                    
                                    IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiPhieuThuTien" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiPhieuTiepNhanActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                        CornerRadius="{StaticResource CornerRadiusHandler}"
                        Padding="10"
                        Margin="5"
                            Style="{StaticResource NavButtonStyle}"
                        HasShadow="True" IsVisible="{Binding QuanLiPhieuTiepNhanPermission}">
                        <HorizontalStackLayout>
                            <Label>üìã</Label>
                            <Label Text="DS phi·∫øu ti·∫øp nh·∫≠n"
                               TextColor="White"
                               FontSize="14"
                               FontFamily="OpenSans-Regular"
                               HorizontalOptions="Center"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiPhieuTiepNhan" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding BaoCaoDoanhSoListActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                            CornerRadius="{StaticResource CornerRadiusHandler}"
                            Padding="10"
                            Margin="5"
                            HasShadow="True" IsVisible="{Binding QuanLiBaoCaoThangPermission}"
                            Style="{StaticResource NavButtonStyle}">
                        <HorizontalStackLayout>
                            <Label>üìà</Label>
                            <Label Text="DS b√°o c√°o th√°ng"
                               TextColor="White"
                               FontSize="14"
                               FontFamily="OpenSans-Regular"
                               HorizontalOptions="Center"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="BaoCaoDoanhSoList" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiBaoCaoTonActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                        CornerRadius="{StaticResource CornerRadiusHandler}"
                        Padding="10"
                        Style="{StaticResource NavButtonStyle}"
                        Margin="5"
                        HasShadow="True" IsVisible="{Binding QuanLiBaoCaoTonPermission}">
                        <HorizontalStackLayout>
                            <Label>üóÉÔ∏è</Label>
                            <Label Text="DS b√°o c√°o t·ªìn"
                               TextColor="White"
                               FontSize="14"
                               FontFamily="OpenSans-Regular"
                               HorizontalOptions="Center"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiBaoCaoTon" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiThongBaoActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                       CornerRadius="{StaticResource CornerRadiusHandler}"
                       Padding="10"
                       Margin="5"
                       Style="{StaticResource NavButtonStyle}"
                       HasShadow="True" IsVisible="{Binding QuanLiThongBaoPermission}">
                        <HorizontalStackLayout>
                            <Label>üìã</Label>
                            <Label Text="Qu·∫£n l√≠ th√¥ng b√°o"
                               TextColor="White"
                               FontSize="14"
                               FontFamily="OpenSans-Regular"
                               HorizontalOptions="Center"
                               LineBreakMode="WordWrap"
                               MaximumWidthRequest="120"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiThongBao" />
                        </Frame.GestureRecognizers>
                    </Frame>
                </VerticalStackLayout>

                <!-- Section: T·∫°o l·∫≠p -->
                <Frame BackgroundColor="#2a557f" IsVisible="{Binding TaoLapSection}"
                       CornerRadius="{StaticResource CornerRadiusHandler}"
                       Padding="10"
                       Margin="5"
                       HasShadow="True">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ToggleSectionCommand}" CommandParameter="TaoLap" />
                    </Frame.GestureRecognizers>
                    <HorizontalStackLayout>
                        <Label VerticalOptions="Center">‚úçÔ∏è</Label>
                        <Label Text="T·∫°o l·∫≠p"
                               TextColor="White"
                               FontAttributes="Bold"
                               FontFamily="OpenSans-SemiBold"
                               FontSize="16"
                               HorizontalOptions="Center"
                               Margin="5"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        <Label Text="{Binding TaoLapExpanded, Converter={StaticResource BoolToArrowConverter}}"
                               VerticalOptions="Center"
                               TextColor="White" />
                    </HorizontalStackLayout>
                </Frame>
                <VerticalStackLayout Spacing="5"
                                     IsVisible="{Binding TaoLapExpanded}">
                    <Frame BackgroundColor="{Binding TiepNhanXeActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                            Style="{StaticResource NavButtonStyle}"
                           Margin="5"
                           HasShadow="True" IsVisible="{Binding TiepNhanXePermission}">
                        <HorizontalStackLayout>
                            <Label>üöò</Label>
                            <Label Text=" Ti·∫øp Nh·∫≠n Xe"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="TiepNhanXe" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding TaoPhieuSuaChuaActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                           Margin="5"
                            Style="{StaticResource NavButtonStyle}"
                           HasShadow="True" IsVisible="{Binding LapPhieuSuaChuaPermission}">
                        <HorizontalStackLayout>
                            <Label>üîß</Label>
                            <Label Text=" L·∫≠p Phi·∫øu S·ª≠a Ch·ªØa"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="TaoPhieuSuaChua" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding TaoPhieuNhapActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                            Style="{StaticResource NavButtonStyle}"
                           Margin="5"
                           HasShadow="True" IsVisible="{Binding LapPhieuNhapPermission}">
                        <HorizontalStackLayout>
                            <Label>üì•</Label>
                            <Label Text=" L·∫≠p Phi·∫øu Nh·∫≠p"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="TaoPhieuNhap" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding ThuTienActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                           Margin="5"
                           HasShadow="True" IsVisible="{Binding LapPhieuThuTienPermission}"
                            Style="{StaticResource NavButtonStyle}">
                        <HorizontalStackLayout>
                            <Label>üßæ</Label>
                            <Label Text=" L·∫≠p Phi·∫øu Thu Ti·ªÅn"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="ThuTien" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding TaoThongBaoActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                       CornerRadius="{StaticResource CornerRadiusHandler}"
                       Padding="10"
                       Margin="5"
                       HasShadow="True" IsVisible="{Binding TaoThongBaoPermission}"
                            Style="{StaticResource NavButtonStyle}">
                        <HorizontalStackLayout>
                            <Label>üîî</Label>
                            <Label Text=" T·∫°o th√¥ng b√°o m·ªõi"
                               TextColor="White"
                               FontSize="14"
                               FontFamily="OpenSans-Regular"
                               HorizontalOptions="Center"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="TaoThongBao" />
                        </Frame.GestureRecognizers>
                    </Frame>
                </VerticalStackLayout>

                <!-- Section: Qu·∫£n tr·ªã -->
                <Frame BackgroundColor="#2a557f" IsVisible="{Binding QuanTriSection}"
                       CornerRadius="{StaticResource CornerRadiusHandler}"
                       Padding="10"
                       Margin="5"
                       HasShadow="True">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ToggleSectionCommand}" CommandParameter="QuanTri" />
                    </Frame.GestureRecognizers>
                    <HorizontalStackLayout>
                        <Label VerticalOptions="Center">‚öôÔ∏è</Label>
                        <Label Text="Qu·∫£n tr·ªã"
                               TextColor="White"
                               FontAttributes="Bold"
                               FontFamily="OpenSans-SemiBold"
                               FontSize="16"
                               HorizontalOptions="Center"
                               Margin="5"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        <Label Text="{Binding QuanTriExpanded, Converter={StaticResource BoolToArrowConverter}}"
                               VerticalOptions="Center"
                               TextColor="White" />
                    </HorizontalStackLayout>
                </Frame>
                <VerticalStackLayout Spacing="5"
                                     IsVisible="{Binding QuanTriExpanded}">
                    <Frame BackgroundColor="{Binding PhanQuyenActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                            Style="{StaticResource NavButtonStyle}"
                           Margin="5"
                           HasShadow="True" IsVisible="{Binding PhanQuyenPermission}">
                        <HorizontalStackLayout>
                            <Label>üóùÔ∏è</Label>
                            <Label Text=" Ph√¢n quy·ªÅn"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   LineBreakMode="WordWrap"
                                   MaximumWidthRequest="120"
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="PhanQuyen" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding ThayDoiThamSoActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                           CornerRadius="{StaticResource CornerRadiusHandler}"
                           Padding="10"
                            Style="{StaticResource NavButtonStyle}"
                           Margin="5"
                           HasShadow="True" IsVisible="{Binding ThayDoiThamSoPermission}">
                        <HorizontalStackLayout>
                            <Label>‚öñÔ∏è</Label>
                            <Label Text=" Tham s·ªë h·ªá th·ªëng"
                                   TextColor="White"
                                   FontSize="14"
                                   FontFamily="OpenSans-Regular"
                                   HorizontalOptions="Center"
                                   IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="ThayDoiThamSo" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiTaiKhoanActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                        CornerRadius="{StaticResource CornerRadiusHandler}"
                        Padding="10"
                        Margin="5"
                            Style="{StaticResource NavButtonStyle}"
                        HasShadow="True" IsVisible="{Binding QuanLiDanhSachTaiKhoanPermission}">
                        <HorizontalStackLayout>
                            <Label>üë•</Label>
                            <Label Text=" Danh s√°ch t√†i kho·∫£n"
                               TextColor="White"
                               FontSize="14"
                               FontFamily="OpenSans-Regular"
                               HorizontalOptions="Center"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiTaiKhoan" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    <Frame BackgroundColor="{Binding QuanLiLichSuActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                        CornerRadius="{StaticResource CornerRadiusHandler}"
                        Padding="10"
                            Style="{StaticResource NavButtonStyle}"
                        Margin="5"
                        HasShadow="True" IsVisible="{Binding QuanLiLichSuPermission}">
                        <HorizontalStackLayout>
                            <Label>‚è∞</Label>
                            <Label Text=" L·ªãch s·ª≠ h√†nh ƒë·ªông"
                               TextColor="White"
                               FontSize="14"
                               FontFamily="OpenSans-Regular"
                               HorizontalOptions="Center"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="QuanLiLichSu" />
                        </Frame.GestureRecognizers>
                    </Frame>
                </VerticalStackLayout>

                <!-- Section: Kh√°ch h√†ng -->
                <Frame BackgroundColor="#2a557f" IsVisible="{Binding KhachHangSection}"
                    CornerRadius="{StaticResource CornerRadiusHandler}"
                    Padding="10"
                    Margin="5"
                    HasShadow="True">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ToggleSectionCommand}" CommandParameter="KhachHang" />
                    </Frame.GestureRecognizers>
                    <HorizontalStackLayout>
                        <Label VerticalOptions="Center">üôã</Label>
                        <Label Text="Kh√°ch h√†ng" 
                           TextColor="White"
                           FontAttributes="Bold"
                           FontFamily="OpenSans-SemiBold"
                           FontSize="16"
                           HorizontalOptions="Center"
                           Margin="5"
                           IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        <Label Text="{Binding KhachHangExpanded, Converter={StaticResource BoolToArrowConverter}}"
                           VerticalOptions="Center"
                           TextColor="White" />
                    </HorizontalStackLayout>
                </Frame>
                <VerticalStackLayout Spacing="5"
                     IsVisible="{Binding KhachHangExpanded}">
                    <Frame BackgroundColor="{Binding DanhSachXeActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                       CornerRadius="{StaticResource CornerRadiusHandler}"
                       Padding="10"
                       Margin="5"
                            Style="{StaticResource NavButtonStyle}"
                       HasShadow="True" IsVisible="{Binding KhachHangXemDanhSachXePermission}">
                        <HorizontalStackLayout>
                            <Label>üöó</Label>
                            <Label Text=" Xe c·ªßa b·∫°n"
                               TextColor="White"
                               FontSize="14"
                               FontFamily="OpenSans-Regular"
                               HorizontalOptions="Center"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                        </HorizontalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="DanhSachXe" />
                        </Frame.GestureRecognizers>
                    </Frame>
                </VerticalStackLayout>

                <!-- Home (kh√¥ng thu·ªôc nh√≥m n√†o) -->
                <Frame BackgroundColor="{Binding TrangChuActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
                       CornerRadius="{StaticResource CornerRadiusHandler}"
                       Padding="10"
                       Margin="5"
                        Style="{StaticResource NavButtonStyle}"
                       HasShadow="True">
                    <HorizontalStackLayout>
                        <Label>üè†</Label>
                        <Label Text=" Home"
                               
                               TextColor="White"
                               FontSize="14"
                               FontFamily="OpenSans-Regular"
                               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                    </HorizontalStackLayout>
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding NavigateCommand}" CommandParameter="Home" />
                    </Frame.GestureRecognizers>
                </Frame>
                <Frame BackgroundColor="{Binding TrangChuActive, Converter={StaticResource BoolToColorConverter}, ConverterParameter={StaticResource ActiveBackgroundColor}}"
       CornerRadius="{StaticResource CornerRadiusHandler}"
       Padding="10"
       Margin="5"
        Style="{StaticResource NavButtonStyle}"
       HasShadow="True">
                    <HorizontalStackLayout>
                        <Label>üîí</Label>
                        <Label Text=" ƒê·ªïi TK v√† MK"
               
               TextColor="White"
               FontSize="14"
               FontFamily="OpenSans-Regular"
               IsVisible="{Binding Source={x:Reference CollapsibleToolbar}, Path=WidthRequest, Converter={StaticResource WidthToVisibilityConverter}}"/>
                    </HorizontalStackLayout>
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ChangePasswordCommand}"/>
                    </Frame.GestureRecognizers>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>

        <ContentView Grid.Column="1"
                     BackgroundColor="{DynamicResource BackgroundColor}"
                     Content="{Binding CurrentPageContent}" />

        <BoxView Grid.Column="2"
         WidthRequest="1"
         BackgroundColor="{DynamicResource TextColor}"
         HorizontalOptions="Start"
         IsVisible="{Binding IsRightPaneVisible}" />

        <ContentView Grid.Column="3"
             x:Name="RightPane"
             MaximumWidthRequest="500"
             BackgroundColor="{DynamicResource BackgroundColor}"
             IsVisible="{Binding IsRightPaneVisible}"
             Padding="10">

            <Grid RowDefinitions="Auto,*">

                <Button Grid.Row="0"
                Text="‚úï"
                HorizontalOptions="End"
                BackgroundColor="{DynamicResource BackgroundColor}"
                TextColor="{DynamicResource TextColor}"
                Command="{Binding CloseRightPaneCommand}" />

                <ContentView Grid.Row="1"
                     Content="{Binding RightPaneContent}" />
            </Grid>
        </ContentView>

    </Grid>
</ContentPage>